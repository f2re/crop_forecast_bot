"""
–ü—Ä–æ—Å—Ç–æ–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å –∫—É–ª—å—Ç—É—Ä –±–µ–∑ API (fallback —Ä–µ–∂–∏–º)
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–≥–¥–∞ –≤–Ω–µ—à–Ω–∏–µ API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
"""
import logging

logger = logging.getLogger(__name__)


def get_region_by_coords(lat, lon):
    """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∞–≥—Ä–æ–∫–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–≥–∏–æ–Ω –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º"""
    # –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è –†–æ—Å—Å–∏–∏ –∏ —Å–æ—Å–µ–¥–Ω–∏—Ö —Å—Ç—Ä–∞–Ω

    # –°–µ–≤–µ—Ä–Ω—ã–µ —Ä–µ–≥–∏–æ–Ω—ã (—Ö–æ–ª–æ–¥–Ω—ã–π –∫–ª–∏–º–∞—Ç)
    if lat > 60:
        return "north"

    # –°—Ä–µ–¥–Ω—è—è –ø–æ–ª–æ—Å–∞
    elif 50 <= lat <= 60:
        return "center"

    # –Æ–∂–Ω—ã–µ —Ä–µ–≥–∏–æ–Ω—ã
    elif lat < 50:
        return "south"

    return "unknown"


def get_simple_recommendations(lat, lon):
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ—Å—Ç—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–æ–ª—å–∫–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ fallback –∫–æ–≥–¥–∞ API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
    """
    region = get_region_by_coords(lat, lon)

    logger.info(f"üåç –û–ø—Ä–µ–¥–µ–ª–µ–Ω —Ä–µ–≥–∏–æ–Ω: {region} –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç {lat}, {lon}")

    recommendations = {
        "north": {
            "suitable": ["barley", "potato", "rapeseed"],
            "crops": [
                {
                    "name": "–Ø—á–º–µ–Ω—å",
                    "name_en": "barley",
                    "rating": 8.5,
                    "yield_estimate": "25-30 —Ü/–≥–∞",
                    "reason": "–•–æ—Ä–æ—à–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω –∫ –ø—Ä–æ—Ö–ª–∞–¥–Ω–æ–º—É –∫–ª–∏–º–∞—Ç—É —Å–µ–≤–µ—Ä–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤",
                    "notes": "–ö–æ—Ä–æ—Ç–∫–∏–π –≤–µ–≥–µ—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥, –º–æ—Ä–æ–∑–æ—É—Å—Ç–æ–π—á–∏–≤"
                },
                {
                    "name": "–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å",
                    "name_en": "potato",
                    "rating": 8.0,
                    "yield_estimate": "200-250 —Ü/–≥–∞",
                    "reason": "–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–∞—è –∫—É–ª—å—Ç—É—Ä–∞ —Å–µ–≤–µ—Ä–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤",
                    "notes": "–¢—Ä–µ–±—É–µ—Ç —Ö–æ—Ä–æ—à–µ–π –≤–ª–∞–∂–Ω–æ—Å—Ç–∏, —É—Å—Ç–æ–π—á–∏–≤ –∫ –ø—Ä–æ—Ö–ª–∞–¥–Ω–æ–π –ø–æ–≥–æ–¥–µ"
                },
                {
                    "name": "–†–∞–ø—Å",
                    "name_en": "rapeseed",
                    "rating": 7.5,
                    "yield_estimate": "20-25 —Ü/–≥–∞",
                    "reason": "–ú–∞—Å–ª–∏—á–Ω–∞—è –∫—É–ª—å—Ç—É—Ä–∞ –¥–ª—è —É–º–µ—Ä–µ–Ω–Ω–æ–≥–æ –∫–ª–∏–º–∞—Ç–∞",
                    "notes": "–¢—Ä–µ–±—É–µ—Ç –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –∞–≥—Ä–æ—Ç–µ—Ö–Ω–∏–∫–∏"
                }
            ],
            "climate_note": "–ö–æ—Ä–æ—Ç–∫–∏–π –≤–µ–≥–µ—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥, –ø—Ä–æ—Ö–ª–∞–¥–Ω–æ–µ –ª–µ—Ç–æ",
            "general_advice": "–í—ã–±–∏—Ä–∞–π—Ç–µ —Ä–∞–Ω–Ω–µ—Å–ø–µ–ª—ã–µ —Å–æ—Ä—Ç–∞, –æ–±—Ä–∞—â–∞–π—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –º–æ—Ä–æ–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å"
        },

        "center": {
            "suitable": ["wheat", "barley", "sunflower", "potato"],
            "crops": [
                {
                    "name": "–ü—à–µ–Ω–∏—Ü–∞",
                    "name_en": "wheat",
                    "rating": 9.0,
                    "yield_estimate": "35-45 —Ü/–≥–∞",
                    "reason": "–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è —Å—Ä–µ–¥–Ω–µ–π –ø–æ–ª–æ—Å—ã –†–æ—Å—Å–∏–∏",
                    "notes": "–Ø—Ä–æ–≤–∞—è –∏ –æ–∑–∏–º–∞—è —Ñ–æ—Ä–º—ã, –≤—ã—Å–æ–∫–∞—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å"
                },
                {
                    "name": "–ü–æ–¥—Å–æ–ª–Ω–µ—á–Ω–∏–∫",
                    "name_en": "sunflower",
                    "rating": 8.5,
                    "yield_estimate": "25-30 —Ü/–≥–∞",
                    "reason": "–•–æ—Ä–æ—à–æ —Ä–∞—Å—Ç–µ—Ç –≤ —É—Å–ª–æ–≤–∏—è—Ö —Å—Ä–µ–¥–Ω–µ–π –ø–æ–ª–æ—Å—ã",
                    "notes": "–ó–∞—Å—É—Ö–æ—É—Å—Ç–æ–π—á–∏–≤, –≤—ã—Å–æ–∫–æ–º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–∞—è –∫—É–ª—å—Ç—É—Ä–∞"
                },
                {
                    "name": "–Ø—á–º–µ–Ω—å",
                    "name_en": "barley",
                    "rating": 8.0,
                    "yield_estimate": "30-35 —Ü/–≥–∞",
                    "reason": "–ù–∞–¥–µ–∂–Ω–∞—è –∫—É–ª—å—Ç—É—Ä–∞ —Å –∫–æ—Ä–æ—Ç–∫–∏–º –≤–µ–≥–µ—Ç–∞—Ü–∏–æ–Ω–Ω—ã–º –ø–µ—Ä–∏–æ–¥–æ–º",
                    "notes": "–•–æ—Ä–æ—à –¥–ª—è –ø–∏–≤–æ–≤–∞—Ä–µ–Ω–∏—è –∏ –∫–æ—Ä–º–æ–≤"
                }
            ],
            "climate_note": "–£–º–µ—Ä–µ–Ω–Ω—ã–π –∫–ª–∏–º–∞—Ç, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ —É–≤–ª–∞–∂–Ω–µ–Ω–∏–µ",
            "general_advice": "–†–∞–∑–Ω–æ–æ–±—Ä–∞–∑—å—Ç–µ —Å–µ–≤–æ–æ–±–æ—Ä–æ—Ç, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–¥–µ—Ä–∞—Ç—ã –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø–æ—á–≤—ã"
        },

        "south": {
            "suitable": ["corn", "sunflower", "soy", "sugar_beet"],
            "crops": [
                {
                    "name": "–ö—É–∫—É—Ä—É–∑–∞",
                    "name_en": "corn",
                    "rating": 9.5,
                    "yield_estimate": "60-80 —Ü/–≥–∞",
                    "reason": "–û—Ç–ª–∏—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è - —Ç–µ–ø–ª–æ –∏ –¥–ª–∏–Ω–Ω—ã–π –≤–µ–≥–µ—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥",
                    "notes": "–í—ã—Å–æ–∫–æ—É—Ä–æ–∂–∞–π–Ω–∞—è –∫—É–ª—å—Ç—É—Ä–∞ –¥–ª—è —é–≥–∞, —Ç—Ä–µ–±—É–µ—Ç –æ—Ä–æ—à–µ–Ω–∏—è"
                },
                {
                    "name": "–ü–æ–¥—Å–æ–ª–Ω–µ—á–Ω–∏–∫",
                    "name_en": "sunflower",
                    "rating": 9.0,
                    "yield_estimate": "30-35 —Ü/–≥–∞",
                    "reason": "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∫—É–ª—å—Ç—É—Ä–∞ –¥–ª—è —é–∂–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤",
                    "notes": "–ó–∞—Å—É—Ö–æ—É—Å—Ç–æ–π—á–∏–≤, –≤—ã—Å–æ–∫–∞—è –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å"
                },
                {
                    "name": "–°–æ—è",
                    "name_en": "soy",
                    "rating": 8.5,
                    "yield_estimate": "25-30 —Ü/–≥–∞",
                    "reason": "–¢–µ–ø–ª–æ–ª—é–±–∏–≤–∞—è –±–æ–±–æ–≤–∞—è –∫—É–ª—å—Ç—É—Ä–∞",
                    "notes": "–£–ª—É—á—à–∞–µ—Ç –ø–æ—á–≤—É, –≤—ã—Å–æ–∫–∞—è —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å"
                }
            ],
            "climate_note": "–¢–µ–ø–ª—ã–π –∫–ª–∏–º–∞—Ç, –¥–ª–∏–Ω–Ω—ã–π –≤–µ–≥–µ—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥",
            "general_advice": "–ü—Ä–æ–¥—É–º–∞–π—Ç–µ —Å–∏—Å—Ç–µ–º—É –æ—Ä–æ—à–µ–Ω–∏—è, –∑–∞—â–∏—Ç—É –æ—Ç –∑–∞—Å—É—Ö–∏"
        }
    }

    if region == "unknown":
        return {
            "crops": [
                {
                    "name": "–ü—à–µ–Ω–∏—Ü–∞",
                    "name_en": "wheat",
                    "rating": 7.0,
                    "yield_estimate": "25-35 —Ü/–≥–∞",
                    "reason": "–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –∫—É–ª—å—Ç—É—Ä–∞",
                    "notes": "–¢—Ä–µ–±—É–µ—Ç—Å—è —É—Ç–æ—á–Ω–µ–Ω–∏–µ –∫–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —É—Å–ª–æ–≤–∏–π"
                }
            ],
            "climate_note": "–ö–ª–∏–º–∞—Ç –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω",
            "general_advice": "–ü—Ä–æ–∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É–π—Ç–µ—Å—å —Å –º–µ—Å—Ç–Ω—ã–º–∏ –∞–≥—Ä–æ–Ω–æ–º–∞–º–∏"
        }

    return recommendations.get(region, recommendations["center"])


def format_simple_recommendation(lat, lon):
    """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –ø—Ä–æ—Å—Ç—É—é —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    rec = get_simple_recommendations(lat, lon)

    text = "üåæ –£–ü–†–û–©–ï–ù–ù–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò\n"
    text += "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n"

    text += f"üìç –í–∞—à —Ä–µ–≥–∏–æ–Ω: {rec['climate_note']}\n\n"

    text += "ü•á –¢–û–ü-3 –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ï –ö–£–õ–¨–¢–£–†–´:\n\n"

    for i, crop in enumerate(rec['crops'][:3], 1):
        text += f"{i}. {crop['name']} - {crop['rating']}/10\n"
        text += f"   –£—Ä–æ–∂–∞–π–Ω–æ—Å—Ç—å: {crop['yield_estimate']}\n"
        text += f"   –ü–æ—á–µ–º—É: {crop['reason']}\n"
        text += f"   üí° {crop['notes']}\n\n"

    text += f"üå°Ô∏è –û–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:\n{rec['general_advice']}\n\n"

    text += "‚ö†Ô∏è –≠—Ç–æ —É–ø—Ä–æ—â–µ–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–æ–ª—å–∫–æ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏.\n"
    text += "–î–ª—è —Ç–æ—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Ç—Ä–µ–±—É—é—Ç—Å—è –∫–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ ERA5,\n"
    text += "—Å–ø—É—Ç–Ω–∏–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ—á–≤–µ.\n\n"

    text += "üí° –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞:\n"
    text += "‚Ä¢ –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É\n"
    text += "‚Ä¢ API –∫–ª—é—á–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ\n"
    text += "‚Ä¢ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å –ø–æ–∑–∂–µ"

    return text
